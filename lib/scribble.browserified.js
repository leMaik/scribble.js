(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.scribblejs = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by CoffeeScript 1.9.3
(function() {
  var EventEmitter,
    slice = [].slice,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  EventEmitter = (function() {
    function EventEmitter() {}

    EventEmitter.prototype.on = function() {
      var base, eventName, handlers, i, l, len, listeners;
      eventName = arguments[0], listeners = 2 <= arguments.length ? slice.call(arguments, 1) : [];
      this._events || (this._events = []);
      handlers = (base = this._events)[eventName] || (base[eventName] = []);
      for (i = 0, len = listeners.length; i < len; i++) {
        l = listeners[i];
        if (indexOf.call(handlers, l) < 0) {
          handlers.push(l);
        }
      }
      return this;
    };

    EventEmitter.prototype.off = function() {
      var eventName, listeners;
      eventName = arguments[0], listeners = 2 <= arguments.length ? slice.call(arguments, 1) : [];
      if (!this._events) {
        return;
      }
      if (eventName) {
        if (!this._events[eventName]) {
          return;
        }
        if (listeners.length > 0) {
          return this._events[eventName] = this._events[eventName].filter(function(h) {
            return indexOf.call(listeners, h) < 0;
          });
        } else {
          return this._events[eventName] = [];
        }
      } else {
        return this._events = [];
      }
    };

    EventEmitter.prototype.trigger = function() {
      var args, eventName, handler, i, len, ref, results;
      eventName = arguments[0], args = 2 <= arguments.length ? slice.call(arguments, 1) : [];
      if (this._events && this._events[eventName]) {
        ref = this._events[eventName];
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          handler = ref[i];
          results.push(handler(args));
        }
        return results;
      }
    };

    return EventEmitter;

  })();

  EventEmitter.installOn = function(object) {
    var emitter;
    emitter = new EventEmitter();
    object.on = emitter.on;
    object.off = emitter.off;
    object.trigger = emitter.trigger;
    return object;
  };

  module.exports = EventEmitter;

}).call(this);

},{}],2:[function(require,module,exports){
var Undo,scribblejs,slice=[].slice;Undo=require("./undo"),scribblejs=function(t){var n;return t.fn.scribble=function(){var o,e,i;return e=arguments[0],o=2<=arguments.length?slice.call(arguments,1):[],this.length>1&&t.error("Scribble.js can only be called on one element at a time."),i=this.data("scribble"),"string"==typeof e&&i?i[e]?"function"==typeof i[e]?i[e].apply(i,o):0===o.length?i[e]:1===o.length?i[e]=o[0]:void 0:t.error("Scribble.js did not recognize the given command."):i?i:(this.data("scribble",new n(this.get(0),e)),this)},n=function(){function n(n,o){var e,i,a,r,s,c;this.el=n,this.canvas=t(n),this.options=t.extend({toolLinks:!0,defaultTool:"marker",defaultColor:"#000000",defaultSize:5,undo:new Undo},o),this.scale=1,this.color=this.options.defaultColor,this.size=this.options.defaultSize,this.tool=this.options.defaultTool,this.background=void 0,null!=this.canvas.data("background")&&(e=new Image,e.onload=function(t){return function(){return t.background=e,t.redraw()}}(this),e.src=this.canvas.data("background")),this.actions=[],this._undo=this.options.undo,this._undo.on("undoAvailable",function(t){return function(){return t.canvas.trigger("scribble:undoAvailable")}}(this)),this._undo.on("undoUnavailable",function(t){return function(){return t.canvas.trigger("scribble:undoUnavailable")}}(this)),this._undo.on("redoAvailable",function(t){return function(){return t.canvas.trigger("scribble:redoAvailable")}}(this)),this._undo.on("redoUnavailable",function(t){return function(){return t.canvas.trigger("scribble:redoUnavailable")}}(this)),a=function(t){return function(n){return null==n?{x:0,y:0}:(n.originalEvent&&n.originalEvent.targetTouches&&(n.pageX=n.originalEvent.targetTouches[0].pageX,n.pageY=n.originalEvent.targetTouches[0].pageY),{x:(n.pageX-t.canvas.offset().left)/t.scale,y:(n.pageY-t.canvas.offset().top)/t.scale})}}(this),i=function(n){return function(){return t.scribble.tools[n.tool]}}(this),r=[],s=!1,c=function(t){return function(n){var o;return s?(s=!1,t.actions=i().stopUse.call(void 0,t.canvas[0].getContext("2d"),a(n),t.actions),t.redraw(),o=function(n,o){return{undo:function(){return t.actions=n,t.redraw()},redo:function(){return t.actions=o,t.redraw()}}},t._undo.push(o(r.slice(0),t.actions.slice(0))),t.canvas.trigger("afterPaint",[t.actions,r])):void 0}}(this),this.canvas.on("scribble:toolchanged",c),this.canvas.bind("mousedown touchstart",function(t){return function(n){return s&&c(n),s=!0,r=t.getShapes(),t.actions.push({tool:t.tool,color:t.color,size:parseFloat(t.size),events:[]}),t.actions=i().startUse.call(void 0,t.canvas[0].getContext("2d"),a(n),t.actions,t.redraw.bind(t),c),t.redraw()}}(this)),this.canvas.bind("mousemove touchmove",function(t){return function(n){return s?(t.actions=i().continueUse.call(void 0,t.canvas[0].getContext("2d"),a(n),t.actions),t.redraw()):void 0}}(this)),this.canvas.bind("mouseup mouseleave mouseout touchend touchcancel",function(t){return function(t){return i().customStopHandling?void 0:c(t)}}(this)),this.options.toolLinks&&t("body").delegate('a[href="#'+this.canvas.attr("id")+'"]',"click",function(n){var o,e,i,a,r,s,c;for(e=t(this),o=t(e.attr("href")),c=o.data("scribble"),s=["color","size","tool"],i=0,r=s.length;r>i;i++)a=s[i],e.attr("data-"+a)&&c.set.call(c,a,t(this).attr("data-"+a));if(t(this).attr("data-download")&&c.download.call(c,t(this).attr("data-download")),t(this).attr("data-action"))switch(e.attr("data-action")){case"undo":c.undo.call(c);break;case"redo":c.redo.call(c)}return!1})}return n.prototype.download=function(t){var n;return t||(t="png"),"jpg"===t&&(t="jpeg"),n="image/"+t,window.open(this.el.toDataURL(n))},n.prototype.setScale=function(t){return this.scale=t,this.redraw()},n.prototype.getShapes=function(){return this.actions.slice()},n.prototype.loadShapes=function(t,n){var o;return null==n&&(n=!1),o=this.actions,this.actions=t,this.redraw(),n?void 0:this.canvas.trigger("afterPaint",[this.actions,o])},n.prototype.undo=function(){return this._undo.undo()},n.prototype.redo=function(){return this._undo.redo()},n.prototype.set=function(t,n){return this[t]=n,"tool"===t&&this.canvas.trigger("scribble:toolchanged",n),this.canvas.trigger("sketch.change"+t,n)},n.prototype.redraw=function(){var n,o,e,i,a,r,s,c,u,l;for(this.el.width=this.canvas.width(),o=this.el.getContext("2d"),null!=this.background&&(s=this.background.width/this.background.height,r=s*this.canvas.height(),a=this.canvas.height(),r>this.canvas.width()&&(r=this.canvas.width(),a=r/s),o.drawImage(this.background,0,0,this.background.width,this.background.height,0,0,r,a)),l=this,c=this.actions,u=[],e=0,i=c.length;i>e;e++)n=c[e],n.tool?u.push(t.scribble.tools[n.tool].draw.call(void 0,n,o,this.scale)):u.push(void 0);return u},n}(),t.scribble={tools:{marker:require("./tools/marker"),highlighter:require("./tools/highlighter"),eraser:require("./tools/eraser"),text:require("./tools/text")}}},scribblejs.Undo=Undo,module.exports=scribblejs;

},{"./tools/eraser":3,"./tools/highlighter":4,"./tools/marker":5,"./tools/text":7,"./undo":8}],3:[function(require,module,exports){
module.exports={startUse:function(n,t,e){return e.pop(),e},continueUse:function(n,t,e){var r,u,o,s,f,a,i,l,c,h;for(o=function(n,t,e){return null==e&&(e=10),Math.abs(n.x-t.x)<e&&Math.abs(n.y-t.y)<e},i=[],u=0,f=e.length;f>u;u++){if(l=e[u],h=!1,null!=l.events)for(c=l.events,s=0,a=c.length;a>s;s++)if(r=c[s],o(t,r)){h=!0;break}h||i.push(l)}return i},stopUse:function(n,t,e){return e},draw:function(n,t){}};

},{}],4:[function(require,module,exports){
var optimize;optimize=require("./optimizePath"),module.exports={startUse:function(e,t,n){return n[n.length-1].events.push(t),n},continueUse:function(e,t,n){return n[n.length-1].events.push(t),n},stopUse:function(e,t,n){return n[n.length-1].events.push(t),n[n.length-1]=optimize(n[n.length-1]),n},draw:function(e,t,n){var o,i,r,s,l;for(t.lineJoin="round",t.lineCap="round",t.beginPath(),t.moveTo(e.events[0].x*n,e.events[0].y*n),l=e.events,i=0,r=l.length;r>i;i++)o=l[i],t.lineTo(o.x*n,o.y*n),s=o;return t.strokeStyle=e.color,t.lineWidth=e.size*n,t.globalCompositeOperation="multiply",t.stroke(),t.closePath(),t.globalCompositeOperation="source-over"}};

},{"./optimizePath":6}],5:[function(require,module,exports){
var optimize;optimize=require("./optimizePath"),module.exports={startUse:function(e,t,n){return n[n.length-1].events.push(t),n},continueUse:function(e,t,n){return n[n.length-1].events.push(t),n},stopUse:function(e,t,n){return n[n.length-1].events.push(t),n[n.length-1]=optimize(n[n.length-1]),n},draw:function(e,t,n){var o,i,r,s,u;for(t.lineJoin="round",t.lineCap="round",t.beginPath(),t.moveTo(e.events[0].x*n,e.events[0].y*n),u=e.events,i=0,r=u.length;r>i;i++)o=u[i],t.lineTo(o.x*n,o.y*n),s=o;return t.strokeStyle=e.color,t.lineWidth=e.size*n,t.stroke(),t.closePath()}};

},{"./optimizePath":6}],6:[function(require,module,exports){
var calculateCurvature,optimizePath,sign;sign=function(t){return"number"==typeof t?t?0>t?-1:1:t===t?0:NaN:NaN},calculateCurvature=function(t,a,e){var r,u,n,x,y;return x={x:a.x-t.x,y:a.y-t.y},y={x:a.x-e.x,y:a.y-e.y},r=x.x*y.y-y.x*x.y,0===r&&(r=1),n=sign(r)*Math.acos((x.x*y.x+x.y*y.y)/(Math.sqrt(x.x*x.x+x.y*x.y)*Math.sqrt(y.x*y.x+y.y*y.y))),u=2/Math.tan(n/2)},optimizePath=function(t){var a,e,r,u,n,x,y,h;for(a=.08,y=t.events,x=[y[0]],n=0,e=r=0,h=y.length-2;h>=0?h>r:r>h;e=h>=0?++r:--r)u=calculateCurvature(y[n],y[e],y[e+1]),Math.abs(u)>a&&(n=e,x.push(y[e]));return x.push(y[y.length-1]),t.events=x,t},module.exports=optimizePath;

},{}],7:[function(require,module,exports){
module.exports={customStopHandling:!0,startUse:function(t,e,n,o,r){var s;return $("body").off(".sketchjstexttool"),s={text:"",x:e.x,y:e.y},n[n.length-1].events.push(s),$("body").on("keydown.sketchjstexttool",function(e){var l,u;return 13===e.keyCode?(e.preventDefault(),e.shiftKey?(u=determineFontHeight(t.fontStyle),s={text:"",x:s.x,y:s.y+u},n[n.length-1].events.push(s)):($("body").off(".sketchjstexttool"),r())):8===e.keyCode?(e.preventDefault(),0===s.text.length?(l=n[n.length-1].events,l.length>1&&(l.pop(),s=l[l.length-1])):s.text=s.text.substring(0,s.text.length-1),o()):void 0}),$("body").on("keypress.sketchjstexttool",function(t){return s.text+=String.fromCharCode(t.charCode),o(),t.preventDefault()}),n},continueUse:function(t,e,n){return n},stopUse:function(t,e,n){return n},draw:function(t,e,n){var o,r,s,l,u;for(e.fillStyle=t.color,l=t.events,u=[],r=0,s=l.length;s>r;r++)o=l[r],e.font=t.size*n+"px Arial",u.push(e.fillText(o.text,o.x*n,o.y*n));return u}};

},{}],8:[function(require,module,exports){
var EventEmitter,Undo,extend=function(t,e){function o(){this.constructor=t}for(var r in e)hasProp.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;EventEmitter=require("event-emitter"),Undo=function(t){function e(){this.undoStack=[],this.redoStack=[]}return extend(e,t),e.prototype.push=function(t){return this.undoStack.push(t),1===this.undoStack.length&&this.trigger("undoAvailable"),this.redoStack.length>0?(this.redoStack=[],this.trigger("redoUnavailable")):void 0},e.prototype.undo=function(){var t;return this.undoStack.length>0&&(t=this.undoStack.pop(),t.undo(),this.redoStack.push(t),0===this.undoStack.length&&this.trigger("undoUnavailable"),1===this.redoStack.length)?this.trigger("redoAvailable"):void 0},e.prototype.redo=function(){var t;return this.redoStack.length>0&&(t=this.redoStack.pop(),t.redo(),this.undoStack.push(t),1===this.undoStack.length&&this.trigger("undoAvailable"),0===this.redoStack.length)?this.trigger("redoUnavailable"):void 0},e}(EventEmitter),module.exports=Undo;

},{"event-emitter":1}]},{},[2])(2)
});